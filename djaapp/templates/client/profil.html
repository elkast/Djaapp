{% extends "base.html" %}

{% block titre %}Mon profil - Djaapp{% endblock %}

{% block contenu %}
<div class="row g-4">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h4 mb-0 fw-semibold">Mon profil</h1>
      <a href="/client/dashboard" class="btn btn-outline-primary">
        <i class="fas fa-arrow-left me-1"></i>Retour au dashboard
      </a>
    </div>
  </div>

  <div class="col-12 col-lg-8">
    <div class="card ombre-douce border-0">
      <div class="card-body p-4">
        <h5 class="card-title fw-semibold mb-4">
          <i class="fas fa-user-edit me-2 text-primaire"></i>Mes informations
        </h5>

        <form method="post" action="/client/profil" class="row g-3" novalidate>
          <div class="col-md-6">
            <label class="form-label fw-semibold" for="champ-nom">Nom complet *</label>
            <input id="champ-nom" name="nom" class="form-control form-control-lg" required value="{{ session.nom if session.nom else '' }}" placeholder="Votre nom complet">
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold" for="champ-email">Adresse email</label>
            <input id="champ-email" name="email" type="email" class="form-control form-control-lg" value="{{ session.email if session.email else '' }}" placeholder="votre@email.com">
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold" for="champ-telephone">Téléphone *</label>
            <input id="champ-telephone" name="telephone" class="form-control form-control-lg" required value="{{ session.telephone if session.telephone else '' }}" placeholder="+225 XX XX XX XX">
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold" for="champ-adresse">Adresse de livraison</label>
            <input id="champ-adresse" name="adresse" class="form-control form-control-lg" value="{{ session.adresse if session.adresse else '' }}" placeholder="Votre adresse complète">
          </div>
          <div class="col-12">
            <hr>
            <div class="d-flex gap-2">
              <button class="btn btn-primaire btn-lg fw-semibold" type="submit">
                <i class="fas fa-save me-2"></i>Enregistrer les modifications
              </button>
              <button class="btn btn-outline-secondary btn-lg" type="button" onclick="resetForm()">
                <i class="fas fa-undo me-1"></i>Annuler
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-4">
    <div class="card ombre-douce border-0 mb-4">
      <div class="card-body text-center p-4">
        <div class="mb-3">
          <i class="fas fa-user-circle fa-4x text-muted"></i>
        </div>
        <h6 class="fw-semibold">{{ session.nom if session.nom else 'Client' }}</h6>
        <p class="text-muted small">{{ session.email if session.email else '' }}</p>
        <div class="mt-3">
          <span class="badge bg-primaire">Client vérifié</span>
        </div>
      </div>
    </div>

    <div class="card ombre-douce border-0">
      <div class="card-body p-4">
        <h6 class="card-title fw-semibold mb-3">
          <i class="fas fa-shopping-bag me-2 text-secondaire"></i>Statistiques
        </h6>
        <div class="row g-3">
          <div class="col-6">
            <div class="text-center">
              <div class="h5 fw-semibold text-secondaire">{{ commandes|length if commandes else 0 }}</div>
              <div class="small text-muted">Commandes</div>
            </div>
          </div>
          <div class="col-6">
            <div class="text-center">
              <div class="h5 fw-semibold text-accent">{{ paniers|length if paniers else 0 }}</div>
              <div class="small text-muted">Panier</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="card ombre-douce border-0">
      <div class="card-body p-4">
        <h5 class="card-title fw-semibold mb-3">
          <i class="fas fa-history me-2 text-primaire"></i>Dernières commandes
        </h5>

        {% if commandes %}
        <div class="row g-3">
          {% for commande in commandes[:3] %}
          <div class="col-md-6 col-lg-4">
            <div class="card border-0 bg-light">
              <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h6 class="card-title fw-semibold mb-0">Commande #{{ commande.id }}</h6>
                  <span class="badge bg-{{ 'success' if commande.statut == 'livre' else 'warning' if commande.statut == 'paye' else 'secondary' }}">
                    {{ commande.statut|title }}
                  </span>
                </div>
                <p class="card-text small text-muted mb-1">{{ commande.date_commande.strftime('%d/%m/%Y') }}</p>
                <p class="card-text fw-semibold text-primaire mb-2">{{ commande.total }} FCFA</p>
                <a href="/client/commande/{{ commande.id }}" class="btn btn-sm btn-outline-primary">
                  <i class="fas fa-eye me-1"></i>Voir détails
                </a>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        <div class="text-center mt-3">
          <a href="/client/commandes" class="btn btn-outline-secondary">
            <i class="fas fa-list me-1"></i>Voir toutes les commandes
          </a>
        </div>
        {% else %}
        <div class="text-center py-4">
          <i class="fas fa-shopping-bag fa-3x text-muted mb-3"></i>
          <h6 class="text-muted fw-semibold">Aucune commande</h6>
          <p class="text-muted small">Vos commandes apparaîtront ici.</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
function resetForm() {
  if (confirm('Annuler les modifications ?')) {
    location.reload();
  }
}
</script>
{% endblock %}
